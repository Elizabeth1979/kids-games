<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>משחק אלף-בית</title>
    <link rel="stylesheet" href="../styles/common.css">
    <link rel="stylesheet" href="../styles/alef-bet.css">
</head>
<body>
    <a href="../index.html" class="back-button">🏠 חזרה למשחקים</a>

    <div class="container">
        <h1>🎨 משחק אלף-בית 🎨</h1>

        <div class="mode-selector">
            <button class="mode-btn active" onclick="setMode('learn')">📚 לומדים</button>
            <button class="mode-btn" onclick="setMode('find')">🔍 מצא את האות</button>
            <button class="mode-btn" id="shuffleBtn" onclick="toggleShuffle()">🔀 ערבב אותיות</button>
        </div>

        <div class="instruction-box" id="instruction">
            לחץ על אות כדי לשמוע את השם שלה
        </div>

        <div class="score-box" id="scoreBox">
            נכון: <span id="correct">0</span> | טעויות: <span id="wrong">0</span>
        </div>

        <div class="alef-bet-grid" id="grid"></div>

        <div class="drawing-section">
            <h2 style="color: #667eea; text-align: center; margin-bottom: 15px;">✏️ לוח ציור ✏️</h2>
            <canvas id="drawingCanvas"></canvas>
            <div class="drawing-controls">
                <div class="control-group">
                    <label>צבע:</label>
                    <input type="color" id="colorPicker" value="#000000">
                </div>
                <div class="control-group">
                    <label>עובי:</label>
                    <input type="range" id="brushSize" min="2" max="20" value="5">
                    <span id="sizeDisplay">5</span>
                </div>
                <button class="control-btn" onclick="clearCanvas()">🗑️ נקה</button>
                <button class="control-btn" onclick="downloadDrawing()">💾 שמור</button>
            </div>
        </div>

        <div class="celebration" id="celebration">🎉</div>
    </div>

    <script>
        const letters = [
            {letter: 'א', name: 'אָלֶף', phonetic: 'Alef'},
            {letter: 'בּ', name: 'בֵּית', phonetic: 'Bet'},
            {letter: 'ב', name: 'וֵית', phonetic: 'Vet'},
            {letter: 'ג', name: 'גִּימֶל', phonetic: 'Gimel'},
            {letter: 'ד', name: 'דָּלֶת', phonetic: 'Dalet'},
            {letter: 'ה', name: 'הֵא', phonetic: 'Heh'},
            {letter: 'ו', name: 'וָו', phonetic: 'Vav'},
            {letter: 'ז', name: 'זַיִן', phonetic: 'Zayin'},
            {letter: 'ח', name: 'חֵית', phonetic: 'Chet'},
            {letter: 'ט', name: 'טֵית', phonetic: 'Tet'},
            {letter: 'י', name: 'יוֹד', phonetic: 'Yod'},
            {letter: 'כּ', name: 'כַּף', phonetic: 'Kaf'},
            {letter: 'כ', name: 'כָף', phonetic: 'Chaf'},
            {letter: 'ל', name: 'לָמֶד', phonetic: 'Lamed'},
            {letter: 'מ', name: 'מֵם', phonetic: 'Mem'},
            {letter: 'נ', name: 'נוּן', phonetic: 'Nun'},
            {letter: 'ס', name: 'סָמֶךְ', phonetic: 'Samech'},
            {letter: 'ע', name: 'עַיִן', phonetic: 'Ayin'},
            {letter: 'פּ', name: 'פֵּא', phonetic: 'Peh'},
            {letter: 'פ', name: 'פֵא', phonetic: 'Feh'},
            {letter: 'צ', name: 'צַדִּי', phonetic: 'Tzadi'},
            {letter: 'ק', name: 'קוֹף', phonetic: 'Kuf'},
            {letter: 'ר', name: 'רֵישׁ', phonetic: 'Resh'},
            {letter: 'שׁ', name: 'שִׁין', phonetic: 'Shin'},
            {letter: 'שׂ', name: 'שִׂין', phonetic: 'Sin'},
            {letter: 'ת', name: 'תָּו', phonetic: 'Tav'},
            {letter: 'ך', name: 'כַּף סוֹפִית', phonetic: 'Chaf Sofit'},
            {letter: 'ם', name: 'מֵם סוֹפִית', phonetic: 'Mem Sofit'},
            {letter: 'ן', name: 'נוּן סוֹפִית', phonetic: 'Nun Sofit'},
            {letter: 'ף', name: 'פֵּא סוֹפִית', phonetic: 'Feh Sofit'},
            {letter: 'ץ', name: 'צַדִּי סוֹפִית', phonetic: 'Tzadi Sofit'}
        ];

        const colors = [
            '#FF6B6B', '#4ECDC4', '#45B7D1', '#FFA07A', '#98D8C8',
            '#F7DC6F', '#BB8FCE', '#85C1E2', '#F8B739', '#52B788',
            '#FFB6C1', '#87CEEB', '#DDA15E', '#B4A7D6', '#F4A261',
            '#E76F51', '#2A9D8F', '#E9C46A', '#F07167', '#00B4D8',
            '#90E0EF', '#CAF0F8', '#FF8FA3', '#C9ADA7', '#A8DADC',
            '#F1FAEE', '#E63946', '#FFD93D', '#6BCF7F', '#A78BFA',
            '#FB923C'
        ];

        let currentMode = 'learn';
        let currentTarget = null;
        let correctCount = 0;
        let wrongCount = 0;
        let currentLetters = [...letters];
        let isShuffled = false;

        const grid = document.getElementById('grid');
        const instruction = document.getElementById('instruction');
        const scoreBox = document.getElementById('scoreBox');
        const celebration = document.getElementById('celebration');
        const shuffleBtn = document.getElementById('shuffleBtn');

        // Canvas setup
        const canvas = document.getElementById('drawingCanvas');
        const ctx = canvas.getContext('2d');
        const colorPicker = document.getElementById('colorPicker');
        const brushSize = document.getElementById('brushSize');
        const sizeDisplay = document.getElementById('sizeDisplay');

        let isDrawing = false;
        let lastX = 0;
        let lastY = 0;

        // Set canvas size
        function resizeCanvas() {
            const rect = canvas.getBoundingClientRect();
            canvas.width = rect.width;
            canvas.height = rect.height;
            ctx.fillStyle = 'white';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
        }

        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);

        // Drawing functions
        function startDrawing(e) {
            isDrawing = true;
            const rect = canvas.getBoundingClientRect();
            const x = (e.clientX || e.touches[0].clientX) - rect.left;
            const y = (e.clientY || e.touches[0].clientY) - rect.top;
            lastX = x * (canvas.width / rect.width);
            lastY = y * (canvas.height / rect.height);
        }

        function draw(e) {
            if (!isDrawing) return;
            e.preventDefault();

            const rect = canvas.getBoundingClientRect();
            const x = (e.clientX || e.touches[0].clientX) - rect.left;
            const y = (e.clientY || e.touches[0].clientY) - rect.top;
            const canvasX = x * (canvas.width / rect.width);
            const canvasY = y * (canvas.height / rect.height);

            ctx.beginPath();
            ctx.moveTo(lastX, lastY);
            ctx.lineTo(canvasX, canvasY);
            ctx.strokeStyle = colorPicker.value;
            ctx.lineWidth = brushSize.value;
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';
            ctx.stroke();

            lastX = canvasX;
            lastY = canvasY;
        }

        function stopDrawing() {
            isDrawing = false;
        }

        canvas.addEventListener('mousedown', startDrawing);
        canvas.addEventListener('mousemove', draw);
        canvas.addEventListener('mouseup', stopDrawing);
        canvas.addEventListener('mouseout', stopDrawing);

        canvas.addEventListener('touchstart', startDrawing);
        canvas.addEventListener('touchmove', draw);
        canvas.addEventListener('touchend', stopDrawing);

        brushSize.addEventListener('input', (e) => {
            sizeDisplay.textContent = e.target.value;
        });

        function clearCanvas() {
            ctx.fillStyle = 'white';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
        }

        function downloadDrawing() {
            const link = document.createElement('a');
            link.download = 'drawing.png';
            link.href = canvas.toDataURL();
            link.click();
        }

        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }

        function toggleShuffle() {
            isShuffled = !isShuffled;

            if (isShuffled) {
                currentLetters = shuffleArray(letters);
                shuffleBtn.style.background = '#FF9800';
                shuffleBtn.style.color = 'white';
                speak('האותיות מעורבבות');
            } else {
                currentLetters = [...letters];
                shuffleBtn.style.background = '';
                shuffleBtn.style.color = '';
                speak('חזרה לסדר רגיל');
            }

            createGrid();
        }

        function createGrid() {
            grid.innerHTML = '';
            currentLetters.forEach((item, index) => {
                const box = document.createElement('div');
                box.className = 'letter-box';

                const letterSpan = document.createElement('div');
                letterSpan.textContent = item.letter;

                const phoneticSpan = document.createElement('div');
                phoneticSpan.className = 'phonetic';
                phoneticSpan.textContent = item.phonetic;

                box.appendChild(letterSpan);
                box.appendChild(phoneticSpan);

                box.style.backgroundColor = colors[letters.indexOf(item)];
                box.onclick = () => handleLetterClick(item);
                grid.appendChild(box);
            });
        }

        function speak(text) {
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'he-IL';
            utterance.rate = 0.8;
            speechSynthesis.cancel();
            speechSynthesis.speak(utterance);
        }

        function setMode(mode) {
            currentMode = mode;
            correctCount = 0;
            wrongCount = 0;
            updateScore();

            document.querySelectorAll('.mode-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            document.querySelectorAll('.letter-box').forEach(box => {
                box.classList.remove('correct', 'wrong', 'highlight');
            });

            if (mode === 'learn') {
                instruction.textContent = 'לחץ על אות כדי לשמוע את השם שלה';
                scoreBox.classList.remove('show');
            } else if (mode === 'find') {
                scoreBox.classList.add('show');
                nextFindChallenge();
            }
        }

        function nextFindChallenge() {
            currentTarget = letters[Math.floor(Math.random() * letters.length)];
            instruction.innerHTML = `מצא את האות <span style="color: #FFD93D; font-size: 1.3em;">${currentTarget.letter}</span>`;
            speak('מצא את האות ' + currentTarget.name);
        }

        function handleLetterClick(item) {
            if (currentMode === 'learn') {
                speak(item.name);
                const box = event.target;
                box.style.transform = 'scale(1.2)';
                setTimeout(() => {
                    box.style.transform = '';
                }, 300);
            } else if (currentMode === 'find') {
                if (item.letter === currentTarget.letter) {
                    handleCorrect();
                } else {
                    handleWrong();
                }
            }
        }

        function handleCorrect() {
            correctCount++;
            updateScore();
            speak('כל הכבוד! נכון!');

            const box = event.target;
            box.classList.add('correct');

            celebration.textContent = ['🎉', '⭐', '🌟', '✨', '🎊'][Math.floor(Math.random() * 5)];
            celebration.style.display = 'block';

            setTimeout(() => {
                celebration.style.display = 'none';
                box.classList.remove('correct');
                nextFindChallenge();
            }, 1500);
        }

        function handleWrong() {
            wrongCount++;
            updateScore();
            speak('נסה שוב');

            const box = event.target;
            box.classList.add('wrong');

            setTimeout(() => {
                box.classList.remove('wrong');
            }, 600);
        }

        function updateScore() {
            document.getElementById('correct').textContent = correctCount;
            document.getElementById('wrong').textContent = wrongCount;
        }

        createGrid();
    </script>
</body>
</html>
